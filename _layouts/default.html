<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title | default: site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}">

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ page.title | default: site.title }}">
  <meta property="og:description" content="{{ page.description | default: site.description }}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  {% if site.brique.logo %}
  <meta property="og:image" content="{{ site.brique.logo | absolute_url }}">
  {% endif %}
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="{{ page.title | default: site.title }}">
  <meta name="twitter:description" content="{{ page.description | default: site.description }}">
  {% if site.brique.logo %}
  <meta name="twitter:image" content="{{ site.brique.logo | absolute_url }}">
  {% endif %}

  <!-- Favicon & PWA -->
  <link rel="icon" href="{{ '/favicon.ico' | relative_url }}" sizes="any">
  <link rel="icon" href="{{ '/assets/img/apple-touch-icon.png' | relative_url }}" type="image/png">
  <link rel="apple-touch-icon" href="{{ '/assets/img/apple-touch-icon.png' | relative_url }}">
  <link rel="manifest" href="{{ '/site.webmanifest' | relative_url }}">
  <meta name="theme-color" content="#3b7dd8">

  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body class="brique-{{ site.brique.color | default: 'blue' }}" data-baseurl="{{ site.baseurl }}">

  <a href="#main-content" class="skip-link">Aller au contenu</a>

  <header class="site-header">
    <div class="header-content">
      <a href="{{ '/' | relative_url }}" class="header-brand">
        {% if site.brique.logo %}
          <img src="{{ site.brique.logo | relative_url }}" alt="{{ site.brique.name }}" class="header-logo">
        {% endif %}
        <span class="header-name">{{ site.brique.name }}</span>
        <span class="header-level" role="img" aria-label="Niveau {{ site.brique.level }} sur 3">
          {% for i in (1..3) %}
            <span class="level-dot {% if i <= site.brique.level %}active{% endif %}" aria-hidden="true"></span>
          {% endfor %}
        </span>
      </a>
      <div class="header-actions">
        <button class="search-toggle" aria-label="Rechercher" title="Rechercher (Ctrl+K)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
        <a href="https://briqueparbrique.github.io" class="header-back">← BriqueParBrique</a>
      </div>
    </div>
  </header>

  <!-- Search modal -->
  <div class="search-modal" id="search-modal" role="dialog" aria-modal="true" aria-label="Recherche" aria-hidden="true">
    <div class="search-modal-backdrop"></div>
    <div class="search-modal-content">
      <input type="search" class="search-input" id="search-input" placeholder="Rechercher dans le parcours…" aria-label="Rechercher dans le parcours" autocomplete="off">
      <div class="search-results" id="search-results" role="region" aria-live="polite" aria-label="Résultats de recherche"></div>
      <div class="search-hint" aria-hidden="true">Échap pour fermer</div>
    </div>
  </div>

  {% if site.brique.status == "development" %}
  <div class="dev-banner" role="alert">
    ⚠ Ce contenu est en cours de développement
  </div>
  {% endif %}

  <main class="site-main" id="main-content">
    {{ content }}
  </main>

  <!-- Back to top -->
  <button class="back-to-top" id="back-to-top" aria-label="Retour en haut" aria-hidden="true" title="Retour en haut">↑</button>

  <footer class="site-footer">
    {% if site.brique.prev_level_url != "" or site.brique.next_level_url != "" %}
    <nav class="level-nav" aria-label="Navigation entre niveaux">
      {% if site.brique.prev_level_url != "" %}
        <a href="{{ site.brique.prev_level_url }}" class="level-nav-link level-nav-prev">← Niveau précédent</a>
      {% endif %}
      {% if site.brique.next_level_url != "" %}
        <a href="{{ site.brique.next_level_url }}" class="level-nav-link level-nav-next">Niveau suivant →</a>
      {% endif %}
    </nav>
    {% endif %}
    {% if site.repository %}
    <div class="footer-links">
      <a href="https://github.com/{{ site.repository }}/edit/main/{{ page.path }}">Modifier cette page</a>
      <a href="https://github.com/{{ site.repository }}/issues/new?title=Problème : {{ page.title | default: site.title | url_encode }}&body=Page : {{ page.url | absolute_url | url_encode }}%0A%0ADécrivez le problème ici.">Signaler un problème</a>
    </div>
    {% endif %}
    <div class="footer-content">
      <p>© {{ 'now' | date: '%Y' }} <a href="https://briqueparbrique.github.io">BriqueParBrique</a></p>
    </div>
  </footer>

  <script src="{{ '/assets/js/progress.js' | relative_url }}" defer></script>

  {% if site.analytics %}
  <!-- Analytics -->
  {% if site.analytics.provider == "plausible" %}
  <script defer data-domain="{{ site.analytics.plausible.domain }}" src="{{ site.analytics.plausible.src | default: 'https://plausible.io/js/script.js' }}"></script>
  {% elsif site.analytics.provider == "matomo" %}
  <script>
    var _paq = window._paq = window._paq || [];
    _paq.push(["trackPageView"]);
    _paq.push(["enableLinkTracking"]);
    (function() {
      var u="{{ site.analytics.matomo.url }}/";
      _paq.push(["setTrackerUrl", u+"matomo.php"]);
      _paq.push(["setSiteId", "{{ site.analytics.matomo.site_id }}"]);
      var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
      g.async=true; g.src=u+"matomo.js"; s.parentNode.insertBefore(g,s);
    })();
  </script>
  {% elsif site.analytics.provider == "google" %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.analytics.google.id }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "{{ site.analytics.google.id }}");
  </script>
  {% endif %}
  {% endif %}

  <!-- Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("{{ '/sw.js' | relative_url }}");
    }
  </script>
</body>
</html>
